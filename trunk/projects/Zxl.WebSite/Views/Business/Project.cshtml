@model Int32

<style type="text/css">
    .polling-browser{ 
        display: none; position: fixed; top: 125px; bottom: 10px;	
        padding-bottom: 40px; border-radius: 4px; 
        background-color: #fff; 
        z-index: 59;}
    .polling-browser.on{z-index: 1020;top: 0;bottom: 0;left: 0;right: 0; width: inherit!important}
    .browser-content{ position: relative;  }
    .browser-content p{ text-align:center;font-size: 20px;padding:35px 0 0 0;}
    .browser-content iframe { position:absolute;top:0;left:0; width: 100%;}
    .browser-content button.icon-close
    {
        z-index: 1021; position: absolute; top: 5px; right: 5px; padding: 5px; 
        border: 0; background: rgba(0, 0, 0, .5); color: #fff; outline: 0;
        border-radius: 4px;width:16px;height:16px;
        background:url('../Images/icons/DeleteRed.png') no-repeat center center;
    }

    .pb-btnGroup{ position: absolute; bottom: 0; width: 100%; border-bottom-right-radius: 4px; border-bottom-left-radius: 4px; background-color: rgba(0 ,0 ,0 ,.5);}
    .pb-btnGroup ul{ width: 100%; margin: 0;}
    .pb-btnGroup li{ display: inline-block; float: left; width: 13%; text-align: center;}
    .pb-btnGroup li:first-child, .pb-btnGroup li:last-child{ width: 17.5%;}
    .pb-btnGroup a{ display: block; height: 40px; line-height: 40px; margin: 0 5px; padding: 0 10px; color: #fff; text-decoration: none;}
    .pb-btnGroup a.btn{	margin: 3px 10px; padding: 0 20px; height: 34px; line-height: 34px;}

</style>
<script type="text/javascript">
    function closePdf() {
        $('.browser-content iframe').attr('src', '');
        $('.polling-browser').hide();
        $('.clearfix .Back').css('display', 'none');
        $('.clearfix .screen').css('display', 'block');
        $('.polling-browser').removeClass('on');
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
        else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        }
        else if (document.webkitCancelFullScreen) {
            document.webkitCancelFullScreen();
        }
        else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    }
    function Switchscreen() {
        $('.clearfix .screen').css('display', 'none');
        $('.clearfix .Back').css('display', 'block');
        $('.polling-browser').addClass('on');
        //浏览器 F11 全屏 google chrome 15 +, safri5.1+,firfox10+,IE11支持
        var docElm = document.documentElement;
        //W3C 
        if (docElm.requestFullscreen) {
            docElm.requestFullscreen();
        }
            //FireFox 
        else if (docElm.mozRequestFullScreen) {
            docElm.mozRequestFullScreen();
        }
            //Chrome等 
        else if (docElm.webkitRequestFullScreen) {
            docElm.webkitRequestFullScreen();
        }
            //IE11 
        else if (docElm.msRequestFullscreen) {
            docElm.msRequestFullscreen();
        }
    };
    function SwitchBack() {
        $('.clearfix .Back').css('display', 'none');
        $('.clearfix .screen').css('display', 'block');
        $('.polling-browser').removeClass('on');
        //浏览器 退出全屏
        if (document.exitFullscreen) {
            document.exitFullscreen();
        }
        else if (document.mozCancelFullScreen) {
            document.mozCancelFullScreen();
        }
        else if (document.webkitCancelFullScreen) {
            document.webkitCancelFullScreen();
        }
        else if (document.msExitFullscreen) {
            document.msExitFullscreen();
        }
    };
</script>

<div class="easyui-layout" data-options="fit:true">
    <div data-options="region:'center',border:false">
        <!-- Begin of toolbar -->
        <div id="wu-toolbar">
            <div class="wu-toolbar-button">
                <a href="#" class="easyui-linkbutton" iconcls="icon-save" onclick="" plain="true">保存</a>
                <a href="#" class="easyui-linkbutton" iconcls="icon-redo" onclick="Dialog_Send()" plain="true">发送</a>
                <a href="#" class="easyui-linkbutton" iconcls="icon-back" onclick="Dialog_Back()" plain="true">回退</a>
                <a href="#" class="easyui-linkbutton" iconcls="icon-print" onclick="" plain="true">打印</a>
            </div>
        </div>
        <!-- End of toolbar -->
        <div class="easyui-tabs" id="formTabs" data-options="border:false, fit:true">
        </div>

        <!--这里显示材料-->
        <div class="polling-browser " style="display: none; ">
            <div class="browser-content">
                <div style="display: none" class="downurl"></div>
                <iframe></iframe>
                <button class="icon-close" onclick="closePdf() "></button>
            </div>
            <div class="pb-btnGroup">
                <ul class="clearfix">
                    <li style="width: 23%"><a href="#" class="btn bg-color-green" onclick="openNext(-1)">上一篇</a></li>
                    <li onclick="Switchscreen()" style="display: block;width: 18%" class="screen"><a href="#"><span class="icon-full-screen"></span> 全屏</a></li>
                    <li onclick="SwitchBack() " style="display: none;width: 18%" class="Back"><a href="#" style="color:#ff8c00"><span class="icon-Exit-full-screen"></span>返回</a></li>
                    <li style="width: 18%" onclick="Downfilebutton()"><a href="#"><span class="icon-download"></span>下载</a></li>
                    <li style="width: 18%" onclick="closePdf()"><a href="#"><span class="icon-close"></span> 关闭</a></li>
                    <li style="width: 23%"><a href="#" class="btn bg-color-blue" onclick="openNext(1)">下一篇</a></li>
                </ul>
            </div>
        </div>


    </div>
    <div data-options="region:'east',border:true,split:true," title="" style="width:250px; padding:0px;">
        <div id="wu-tabs" class="easyui-tabs" data-options="border:false,fit:true">
            <div title="表单" data-options="href:'@Url.Action("ProjectForm", "Business", new { ProjectId = Model })',closable:false,iconCls:'icon-page-white-excel',cls:'pd3'"></div>
            <div title="材料" data-options="href:'@Url.Action("ProjectMaterial", "Business", new { ProjectId = Model })',closable:false,iconCls:'icon-page-white-word',cls:'pd3'"></div>
            <div title="流程日志" data-options="href:'temp/layout-1.html',closable:false,iconCls:'icon-node-tree16',cls:'pd3'"></div>
        </div>
    </div>
</div>
<div id="dialogSend" class="easyui-dialog" data-options="closed:true,iconCls:'icon-redo'" style="width:400px; height:500px;">
    <div id="wu-tabs" class="easyui-tabs" data-options="border:false,fit:true">
        <div title="人员选择" data-options="href:'@Url.Action("Dialog_SendUser", "Business", new { ProjectId = Model })',closable:false,iconCls:'icon-user',cls:'pd2'"></div>
    </div>
</div>

<script type="text/javascript">
    function Dialog_Send(){
        $('#dialogSend').dialog({
            closed: false,
            modal:true,
            title: "发送",
            buttons: [{
                text: '发送',
                iconCls: 'icon-redo',
                handler: function ()
                {
                    $.ajax({
                        url: '@Url.Action("DoSend", "Business")',
                        data: { ProjectId: @Model, RecvUserId: Business.SendUser },
                        type: 'POST',
                        success: function (json) {
                            if(json.ReturnCode == 0)
                            {
                                $.messager.alert('提示', '发送成功！', 'info',
                                    function(){
                                        $('#dialogSend').dialog('close');
                                        removeTab();
                                        RefreshProcessing();
                                    }
                                );
                            }
                            else
                            {
                                $.messager.alert('提示', '发送失败！<br>' + json.Message, 'error');
                            }
                        }
                    });
                }
            },
              {
                  text: '取消',
                  iconCls: 'icon-cancel',
                  handler: function () {
                      $('#dialogSend').dialog('close');
                  }
              }]
        });
    }

    function Dialog_Back()
    {
        $.messager.confirm('回退确认', '确定要回退到上一个环节吗？', function(r){
            if (r){
                $.ajax({
                    url: '@Url.Action("DoBack", "Business")',
                    data: { ProjectId: @Model },
                    type: 'POST',
                    success: function (json) {
                        if(json.ReturnCode == 0)
                        {
                            $.messager.alert('提示', '回退成功！', 'info',
                                function(){
                                    removeTab();
                                    RefreshProcessing();
                                }
                            );
                        }
                        else
                        {
                            $.messager.alert('提示', '回退失败！<br>' + json.Message, 'error');
                        }
                    }
                });
            }
        });
    }
</script>